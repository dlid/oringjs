;new function(n){function e(n){return Array.prototype.slice.call(n)}function t(){return++c+""+(new Date).getTime()}function o(n){var e;try{e=JSON.parse(n)}catch(n){e=null}if("object"==typeof e){if(void 0!==e._d&&void 0!==e._t&&void 0!==e._w)var t=Object.create(f,{data:{value:e._d,enumerable:!1},type:{value:e._t},invocationId:{value:e._i?e._i:null}});return t}}function r(n,e,t){return Object.create(h,{type:{value:n},data:{value:e},created:{value:(new Date).getTime()},invocationId:{value:t||null}})}function i(n){function i(n,o){if(n.__proto__==f){var r,i=n.getData().methods,s={};for(r=0;r<i.length;r++)if(-1==i[r].n.indexOf(".")){var l=i[r].n,c=i[r].r;s[i[r].n]=function(){var n=null;return c&&(n=t()),o("*",l,n,e(arguments))}}return console.warn("context",s),s}return null}var c=["webSocket","longPolling"],u=s.extend({url:null,hubs:[],transferProtocols:c},n);n.transferProtocols&&(u.transferProtocols=n.transferProtocols),console.warn("SETTINGS",u);var a=function(n){var e=n.indexOf("?"),t=null;-1!=e&&(t=n.substring(e+1),n=n.substring(0,e));var o=n.match(/((?:http|ws|)s?:\/\/|^)([^:]+?)(?::(\d+)|$)/);if(o){var r=o[1],i=o[2],s=o[3]?o[3]:null;return{schema:r?r.replace(/:\/\/$/,""):"http",path:i,port:s,querystring:t}}}(n.url);this.start=function(){function n(){(c+=1)<h.length?((t=new h[c].class).onclose=function(){console.warn("Connection was lost")},t.start(a,u.hubs).done(function(){t.onmessage=function(n){var l=o(n);if(console.warn("MSG",l),f)console.warn("Ok, we're cool. Message is ",l);else if("oring:handshake"==l.getType()){f=!0;var u=i(l,function(n,e,o,arguments){var i=s.Deferred(),l=r("oring:invoke",{hub:n,name:e,args:arguments},o);return o&&(console.warn("WOA! Listen for","oring:response__"+o),setTimeout(function(){i.resolve()},2e3)),t.send(l),o||i.resolve(),i.promise()});u&&(u.transferProtocol=h[c].name,e.resolve(u)),console.warn("handskahe complete")}else console.warn("Message received without handshake...",l)},console.warn("Alright, "+h[c].name+" succeeded")}).fail(function(){console.warn("Noo, "+h[c].name+" failed"),n()})):(p("No protocol could connect ("+u.transferProtocols.join(",")+")"),e.reject())}var e=s.Deferred(),t=null,c=-1,f=!1,h=[],d=!1;for(c=0;c<u.transferProtocols.length;c++){for(d=!0,t=0;t<l.length;t++)if(u.transferProtocols[c]==l[t].name){h.push(l[t]),d=!1;break}d&&p("Unknown transferProtcol",u.transferProtocols[c])}return c=-1,t=null,n(),e.promise()},n.url||p("URL was not provided")}var s=this,l=[],c=-1;(function(n){n("object"==typeof exports?exports:this)}).call(this,function(n){var e=Array.prototype.slice,t=Array.prototype.forEach,o=function(n){if("object"!=typeof n)throw n+" is not an object";var r=e.call(arguments,1);return t.call(r,function(e){if(e)for(var t in e)"object"==typeof e[t]&&n[t]?o.call(n,n[t],e[t]):n[t]=e[t]}),n};n.extend=o}),function(n){function e(n){return"[object Array]"===Object.prototype.toString.call(n)}function t(n,t){if(e(n))for(var o=0;o<n.length;o++)t(n[o]);else t(n)}function o(n){var r="pending",i=[],s=[],l=[],c=null,u={done:function(){for(var n=0;n<arguments.length;n++)if(arguments[n])if(e(arguments[n]))for(var t=arguments[n],o=0;o<t.length;o++)"resolved"===r&&t[o].apply(this,c),i.push(t[o]);else"resolved"===r&&arguments[n].apply(this,c),i.push(arguments[n]);return this},fail:function(){for(var n=0;n<arguments.length;n++)if(arguments[n])if(e(arguments[n]))for(var t=arguments[n],o=0;o<t.length;o++)"rejected"===r&&t[o].apply(this,c),s.push(t[o]);else"rejected"===r&&arguments[n].apply(this,c),s.push(arguments[n]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var n=0;n<arguments.length;n++)if(arguments[n])if(e(arguments[n]))for(var t=arguments[n],o=0;o<t.length;o++)"pending"===r&&l.push(t[o]);else"pending"===r&&l.push(arguments[n]);return this},then:function(){arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2])},promise:function(n){if(null==n)return u;for(var e in u)n[e]=u[e];return n},state:function(){return r},debug:function(){console.log("[debug]",i,s,r)},isRejected:function(){return"rejected"===r},isResolved:function(){return"resolved"===r},pipe:function(n,e,r){return o(function(o){t(n,function(n){"function"==typeof n?a.done(function(){var e=n.apply(this,arguments);e&&"function"==typeof e?e.promise().then(o.resolve,o.reject,o.notify):o.resolve(e)}):a.done(o.resolve)}),t(e,function(n){"function"==typeof n?a.fail(function(){var e=n.apply(this,arguments);e&&"function"==typeof e?e.promise().then(o.resolve,o.reject,o.notify):o.reject(e)}):a.fail(o.reject)})}).promise()}},a={resolveWith:function(n){if("pending"===r){r="resolved";for(var e=c=arguments.length>1?arguments[1]:[],t=0;t<i.length;t++)i[t].apply(n,e)}return this},rejectWith:function(n){if("pending"===r){r="rejected";for(var e=c=arguments.length>1?arguments[1]:[],t=0;t<s.length;t++)s[t].apply(n,e)}return this},notifyWith:function(n){if("pending"===r)for(var e=c=arguments.length>1?arguments[1]:[],t=0;t<l.length;t++)l[t].apply(n,e);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},f=u.promise(a);return n&&n.apply(f,[f]),f}o.when=function(){if(arguments.length<2){var n=arguments.length?arguments[0]:void 0;return n&&"function"==typeof n.isResolved&&"function"==typeof n.isRejected?n.promise():o().resolve(n).promise()}return function(n){for(var e=o(),t=n.length,r=0,i=new Array(t),s=0;s<n.length;s++)!function(o){var s=null;n[o].done?n[o].done(function(){i[o]=arguments.length<2?arguments[0]:arguments,++r==t&&e.resolve.apply(e,i)}).fail(function(){e.reject(arguments)}):(s=n[o],n[o]=new Deferred,n[o].done(function(){i[o]=arguments.length<2?arguments[0]:arguments,++r==t&&e.resolve.apply(e,i)}).fail(function(){e.reject(arguments)}).resolve(s))}(s);return e.promise()}(arguments)},n.Deferred=o}(s);var u=function(n,e,t){var o=s.extend({method:"get",url:null},n),r=a();r.open("get",o.url,!0),r.send(null),r.onreadystatechange=function(){4===r.readyState&&(200===r.status?e.call(null,r.responseText):t.call(null,r.responseText))}},a=function(){if(void 0!==typeof XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)for(var n=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],e=0;e<n.length;e++)try{return new ActiveXObject(n[e])}catch(n){}};l.push({name:"longPolling",class:function(){this.onclose=null,this.onmessage=null,this.send=function(n){n.__proto__==h||p("That's no request")},this.start=function(n,e){var t=s.Deferred(),o="";return o="https"==n.schema||"wss"==n.schema?"https://":"http://",o+=n.path,n.port&&(o+=":"+n.port),n.querystring&&(o+="?"+n.querystring),n.querystring?o+="&":o+="?",o+="__oringprotocol=longPolling",e&&e.length>0&&(n.querystring&&(o+="&"),o+="__oringhubs="+encodeURIComponent(e.join(","))),console.warn("longPolling",o),u({url:o},function(){t.resolve()},function(){t.reject()}),t.promise()}}});var f={data:null,sent:null,invocationId:null,type:null,getType:function(){return this.type},getData:function(){return this.data}},h={data:null,created:null,invocationId:null,type:null,getType:function(){return this.type},getData:function(){return this.data},toJSON:function(){return JSON.stringify({_t:this.type,_d:this.data,_c:this.created,_i:this.invocationId})}},p=function(){if(console&&console.error){var n=e(arguments);n.unshift("[oring] "),console.error.apply(console,n)}},d=function(n,e){var t=s.extend({url:n,hubs:[]},e);return console.warn("options",t),new i(t)};l.push({name:"webSocket",class:function(){var n,e=this;this.onclose=null,this.onmessage=null,this.send=function(e){e.__proto__==h?n&&(console.warn("SEND",e),n.send(e.toJSON())):p("That's no request")},this.start=function(t,o){var r=s.Deferred(),i="";return i="https"==t.schema||"wss"==t.schema?"wss://":"ws://",i+=t.path,t.port&&(i+=":"+t.port),t.querystring&&(i+="?"+t.querystring),o&&o.length>0&&(t.querystring&&(i+="&"),i+="__oringhubs="+encodeURIComponent(o.join(","))),n=new WebSocket(i,"oringserver"),n.onopen=function(n){r.resolve()},n.onclose=function(n){p("Connection closed",n),"function"==typeof e.onclose&&e.onclose()},n.onerror=function(n){r&&r.reject(n)},n.onmessage=function(n){n&&n.data&&e.onmessage(n.data)},r.promise()}}}),n.oring=new function(){this.create=function(){return d.apply(this,e(arguments))},this._core=s,console.warn("CORE",s)}(s)}(window);