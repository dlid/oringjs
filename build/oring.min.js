!function(n){function e(n){return Array.prototype.slice.call(n)}function t(n){var e=function(n){var e=n.indexOf("?"),t=null;-1!=e&&(t=n.substring(e+1),n=n.substring(0,e));var r=n.match(/((?:http|ws|)s?:\/\/|^)([^:]+?)(?::(\d+)|$)/);if(r){var o=r[1],i=r[2],s=r[3]?r[3]:null;return{schema:o?o.replace(/:\/\/$/,""):"http",path:i,port:s,querystring:t}}}(n.url);this.start=function(){console.warn("Start connection");for(var n=0;n<o.length;n++)(new o[n]).start(e)},n.url||i("URL was not provided")}var r=this,o=[];!function(n){function e(n){return"[object Array]"===Object.prototype.toString.call(n)}function t(n,t){if(e(n))for(var r=0;r<n.length;r++)t(n[r]);else t(n)}function r(n){var o="pending",i=[],s=[],c=[],f=null,l={done:function(){for(var n=0;n<arguments.length;n++)if(arguments[n])if(e(arguments[n]))for(var t=arguments[n],r=0;r<t.length;r++)"resolved"===o&&t[r].apply(this,f),i.push(t[r]);else"resolved"===o&&arguments[n].apply(this,f),i.push(arguments[n]);return this},fail:function(){for(var n=0;n<arguments.length;n++)if(arguments[n])if(e(arguments[n]))for(var t=arguments[n],r=0;r<t.length;r++)"rejected"===o&&t[r].apply(this,f),s.push(t[r]);else"rejected"===o&&arguments[n].apply(this,f),s.push(arguments[n]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var n=0;n<arguments.length;n++)if(arguments[n])if(e(arguments[n]))for(var t=arguments[n],r=0;r<t.length;r++)"pending"===o&&c.push(t[r]);else"pending"===o&&c.push(arguments[n]);return this},then:function(){arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2])},promise:function(n){if(null==n)return l;for(var e in l)n[e]=l[e];return n},state:function(){return o},debug:function(){console.log("[debug]",i,s,o)},isRejected:function(){return"rejected"===o},isResolved:function(){return"resolved"===o},pipe:function(n,e,o){return r(function(r){t(n,function(n){"function"==typeof n?u.done(function(){var e=n.apply(this,arguments);e&&"function"==typeof e?e.promise().then(r.resolve,r.reject,r.notify):r.resolve(e)}):u.done(r.resolve)}),t(e,function(n){"function"==typeof n?u.fail(function(){var e=n.apply(this,arguments);e&&"function"==typeof e?e.promise().then(r.resolve,r.reject,r.notify):r.reject(e)}):u.fail(r.reject)})}).promise()}},u={resolveWith:function(n){if("pending"===o){o="resolved";for(var e=f=arguments.length>1?arguments[1]:[],t=0;t<i.length;t++)i[t].apply(n,e)}return this},rejectWith:function(n){if("pending"===o){o="rejected";for(var e=f=arguments.length>1?arguments[1]:[],t=0;t<s.length;t++)s[t].apply(n,e)}return this},notifyWith:function(n){if("pending"===o)for(var e=f=arguments.length>1?arguments[1]:[],t=0;t<c.length;t++)c[t].apply(n,e);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},a=l.promise(u);return n&&n.apply(a,[a]),a}r.when=function(){if(arguments.length<2){var n=arguments.length?arguments[0]:void 0;return n&&"function"==typeof n.isResolved&&"function"==typeof n.isRejected?n.promise():r().resolve(n).promise()}return function(n){for(var e=r(),t=n.length,o=0,i=new Array(t),s=0;s<n.length;s++)!function(r){var s=null;n[r].done?n[r].done(function(){i[r]=arguments.length<2?arguments[0]:arguments,++o==t&&e.resolve.apply(e,i)}).fail(function(){e.reject(arguments)}):(s=n[r],n[r]=new Deferred,n[r].done(function(){i[r]=arguments.length<2?arguments[0]:arguments,++o==t&&e.resolve.apply(e,i)}).fail(function(){e.reject(arguments)}).resolve(s))}(s);return e.promise()}(arguments)},n.Deferred=r}(r);var i=function(){if(console&&console.error){var n=e(arguments);n.unshift("[oring] "),console.error.apply(console,n)}},s=function(n,e){var r={url:n,hubs:e=e||[]};return console.warn("options",r),new t(r)};o.push(function(){var n;this.start=function(e){console.warn("start websocket",e);var t="";t="https"==e.schema||"wss"==e.schema?"wss://":"ws://",t+=e.path,e.port&&(t+=":"+e.port),e.querystring&&(t+="?"+e.querystring),(n=new WebSocket(t,"oringserver")).onopen=function(n){console.warn("Connection opened",n)},n.onclose=function(n){console.warn("Connection closed",n)},n.onerror=function(n){console.warn("Connection error",n)},n.onmessage=function(n){console.warn("RECEIVED",n.data)}}}),n.oring=new function(){this.create=function(){return console.warn("CRAETE",e(arguments)),s.apply(this,e(arguments))},this._core=r}(r)}(window);